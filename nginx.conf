# Nginx 运行的用户名和用户组，格式为"user user [group];"
user nginx;

# Nginx 进程数，通常设置成和 CPU 的数量相等
worker_processes auto;

# 将 Nginx 进程绑定到指定 CPU
worker_cpu_affinity auto;
# 设置进程优先级，默认为0，取值范围是-20~20
worker_priority 0;

# 日志文件位置及其等级(debug\info\notice\warn\error\crit\alert\emerg)，越在后面的等级显示的日志越少，默认是error
error_log /var/log/nginx/error.log info;
# pid 文件地址，记录了 Nginx 的 pid，方便进程管理
pid /run/nginx.pid;

# 下面几项通常无需配置
# 如果进程出现问题了，就会记录一个 core 文件，working_directory 指定记录日志的文件的存放位置目录，worker_rlimit_core 用于指定记录的文件大小
# working_directory directory;
# worker_rlimit_core size;
# 指定每个工作进程可以打开的最大文件句柄数，简单的理解为：可以建立连接的数量
# worker_rlimit_nofile number;
# shutdown 之后超时的时间
# worker_shutdown_timeout time;

# 事件模块 event
events {
    # 指定要使用的连接处理方法(select/poll/kqueue/epoll/'/dev/poll'/eventport)，通常无需设置，Nginx 会默认使用当前系统中最有效的模式
    # use method;

    # 每个 worker_processes 的最大并发链接数，并发总数：worker_processes * worker_connections
    worker_connections 1024;

    # 其他项基本无需配置
    # 互斥锁相关，不同连接之间是否使用互斥锁进行顺序 accept() 系统调用的配置，
    # 设置为 on，则工作进程将依次接受新连接
    # 设置为 off，则所有工作进程都会收到有关新连接的通知，如果新连接的数量较低，则一些工作进程可能会浪费系统资源
    # accept_mutex on | off;
    # 默认值是 500ms，如果启用了 accept_mutex，可以指定某个工作进程检测到其它工作进程正在接入新连接时，自身等待直到重新开始尝试接入新连接的最大时间间隔
    # accept_mutex_delay time;
    # 开启针对特定客户端连接的调试日志
    # debug_connection address | CIDR | unix:;
    # 设置为 off，则工作进程将一次接受一个新连接
    # 设置为 on，则工作进程将一次接受所有新连接
    # 如果使用 kqueue 连接处理方式，则忽略该指令，因为 kqueue 可以报告有多少新连接等待接入
    # multi_accept on | off;
}

# 全局的 http 设置
http {
    # 加载一些 MIME 类型信息
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # 设置MIME类型哈希桶大小，其默认值取决于处理器的缓存线长度
    # types_hash_bucket_size size;
    # 设置MIME类型哈希表的最大size(容量)
    types_hash_max_size 2048;

    # 默认值是 32|64|128，为了通过哈希表快速匹配主机名，这里就是设置这个哈希表的大小
    server_names_hash_bucket_size 64;
    # 设置主机名哈希表的最大 size，设置的越大，占用的内存越高，但哈希冲突越低，检索速度也越快
    server_names_hash_max_size 512;
    # 在错误信息的 “Server” 响应头(比如404)中输出的内容
    # on：显示 nginx/版本号(服务器操作系统)
    # off：显示 nginx
    # build：显示 nginx/构建版本号(服务器操作系统)
    # string：商业版可用，显示设置的字符串
    server_tokens off;
    # 是否使用 server_name 做为跳转时的 Host 部分，默认 off
    server_name_in_redirect off;

    # 控制重定向跳转时带不带上原来的端口，默认 on
    port_in_redirect on;

    # 长连接
    # 指定哪些浏览器不使用长连接功能
    # keepalive_disable none | browser......;
    # 设置通过一个长连接可以处理的最大请求数，请求数超过此值，长连接将关闭
    # keepalive_requests number;
    # 限制通过一个保持活动连接处理请求的最长时间
    # keepalive_time time;
    # 设置客户端的长连接在服务器端保持的最长时间
    # 在 timeout 设置的时间内，客户端未发起新请求，则长连接关闭
    # 第二个参数为可选项，设置 “Keep-Alive: timeout=time” 响应头的值
    # 可以为这两个参数设置不同的值
    # “Keep-Alive: timeout=time” 响应头可以被 Mozilla 和 Konqueror 浏览器识别和处理，MSIE 浏览器在大约 60 秒后会关闭长连接
    keepalive_timeout 65;
    # 控制 Nginx 如何关闭客户端连接
    # on：默认值，指示 Nginx 在完成关闭连接前等待和处理客户端发来的额外数据
    #     但只有在预测客户端可能发送更多数据的情况才会做此处理
    #     为了控制关闭HTTP/2连接，必须在 server(1.19.1) 下指定该指令
    # always：指示 Nginx 无条件等待和处理客户端的额外数据
    # off：指示nginx立即关闭连接，而绝不等待客户端传送额外数据
    #      这样做破坏了协议，所以正常条件下不应使用
    # lingering_close off | on | always;
    # lingering_close 生效时 Nginx 处理(读取但忽略)客户端额外数据的最长时间，默认值是 5s
    # 如果在这段时间内，Nginx 没有接收到数据，Nginx 将关闭连接
    # 否则，Nginx 将接收数据，忽略它，然后再等待更多数据
    # 这个“等待——接收——忽略”的循环一直重复，但总时间不会超过 lingering_time 指令定义的时间
    # lingering_time time;

    # nginx 发出的重定向是绝对路径(on)还是相对路径(off)
    absolute_redirect on;

    # 请求头处理
    # 设置读取客户端请求头部的缓冲容量，默认值是 1k
    # client_header_buffer_size size;
    # 设置读取客户端请求超大请求的缓冲最大 number(数量) 和每块缓冲的 size(容量)，默认值是 4 8k
    # 条件：HTTP 请求行的长度不能超过一块缓冲的容量，否则 nginx 返回错误 414(Request-URI Too Large) 到客户端
    #      每个请求头的长度也不能超过一块缓冲的容量，否则 nginx 返回错误 400(Bad Request) 到客户端
    #      (请求行+请求头)的大小不能超过 32k(4 * 8k)
    # large_client_header_buffers number size;
    # 定义读取客户端请求头部的超时时间，默认值是60s，客户端在这段时间内没有传送完整的头部到 Nginx，Nginx 将返回错误 408(Request Time-out) 到客户端
    # client_header_timeout time;
    # 如果请求中含有字节范围的请求头，这条指令可以限制此范围允许的最大值
    # 如果请求头的值超过此限制，将按请求未携带此请求头的情况处理
    # 默认nginx对此不做限制
    # 设置为 0 将使 Nginx 完全不支持 HTTP 字节范围特性
    # max_ranges number;
    # 允许或禁止在客户端请求头中使用下划线，默认值是 off
    # underscores_in_headers on | off;
    # 控制是否忽略非法的请求头字段名，默认值是 on
    # ignore_invalid_headers on | off;

    # 浏览器缓存
    # 指定响应的修改时间与 if_modified_since 请求头的比较方法，默认值是 exact
    # 由浏览器发送的，让服务端来判断返回 200 还是 304
    # off：忽略 if_modified_since 请求头
    # exact：精确匹配
    # before：响应的修改时间 ≤ if_modified_since 请求头指定的时间
    # if_modified_since off | exact | before;
    # 由服务器端生成，客户端通过发送 If-Match 或者 If-None-Match 这个条件判断请求来验证资源是否修改
    # 这个配置可以开启或关闭为静态文件自动计算 “ETag” 响应头
    # 默认值为 on
    # etag on | off;

    # 文件处理
    # 当读入长度大于等于指定 size 的文件时，开启 DirectIO 功能，默认 off
    # directio size | off;
    # 为 DirectIO 设置文件偏移量对齐
    # directio_alignment size;
    # 配置文件缓存，默认值是 off，关闭状态
    # max=N，设置缓存中元素的最大数量，当缓存溢出时，使用 LRU(最近最少使用) 算法删除缓存中的元素
    # inactive=time，在这段时间内缓存元素如果没有被访问，将从缓存中删除，默认超时是 60s
    # 可以缓存的内容包括：打开文件的描述符、大小和修改时间，目录查找结果，文件查找时的错误结果，诸如“file not found”(文件不存在)、“no read permission”(无读权限)等
    # open_file_cache off | max=N [inactive=time];
    # 开启或者关闭缓存文件查找的错误结果，默认值 off
    # open_file_cache_errors on | off;
    # 设置在由 open_file_cache 指令的 inactive 参数配置的超时时间内， 文件应该被访问的最小 number(次数)
    # open_file_cache_min_uses number;
    # 设置检查 open_file_cache 缓存的元素的时间间隔，默认 60s
    # open_file_cache_valid time;
    # 开启或关闭使用 sendfile() 调用
    sendfile on;
    # 默认值是 0，通过将 kqueue 方法的 NOTE_LOWAT 标志， 或者将套接字的 SO_SNDLOWA T 属性设置成指定的 size 实现的
    # 设置成非 0 值，Nginx 将尝试最小化向客户端发送数据的次数
    # send_lowat size;
    # 设置为非 0 值时，可以限制在一次 sendfile() 调用时传输的数据量
    # 设置为 0 是没有限制
    # sendfile_max_chunk size;

    # 其他
    # 权限配置相关，当配置并使用了 auth_basic、auth_request 或者 auth_jwt 相关的模块时，定义一个超时时间，用于防止定时攻击
    # 默认 0s，没有开启
    # auth_delay time;
    # 允许关闭HTTP/1.1中的分块传输编码
    # 默认值是 on，在客户端软件不支持分块传输编码或者不希望使用分块传输的时候，这条指令可以关掉它
    # chunked_transfer_encoding on | off;
    # 微调为每个连接分配的内存
    # connection_pool_size size;
    # 开启或者关闭在 error_log 中记录文件不存在的错误
    # 默认值是 on，访问一个不存在的页面，找不到对应的文件，一般会报出一个 404 错误，并且对应的 error_log 日志文件中会记录一条信息
    # off：在 error_log 中不记录这条信息，只在 access_log 中记录
    log_not_found on;
    # 开启或者关闭将请求 URI 中相邻两个或更多斜线合并成一个的功能
    merge_slashes on;
    # 默认 on，在响应状态码大于等于 400 时，在响应正文中添加一段注释，使响应正文达到512字节
    # 可以为 MSIE 客户端开启或关闭这个功能
    # msie_padding on | off;
    # 默认 off，为 MSIE 客户端开启或者关闭用页面刷新取代页面重定向的功能
    # msie_refresh on | off;
    # 设置用于从磁盘读取响应的缓冲区的数量和大小
    # 默认值是 1 32k
    # output_buffers number size;
    # 如果可能，到客户端的数据将被推迟发送，直到nginx需要发送的数据至少有size字节
    # 默认值是 1460， 设置为0将关闭推迟发送的功能
    # 它是在 Nginx 层面所作的与 TCP_CORK 类似的一个优化
    # postpone_output size;
    # 设置内核参数，控制文件预读的数量，默认值是 0
    # read_ahead size;
    # 允许或禁止 error_page 指令进行多次重定向，默认 off
    # recursive_error_pages on | off;
    # 默认值 4k，允许对每个请求的内存分配进行细调，主要是影响内存池的存储情况
    # request_pool_size size;
    # 开启或关闭重置超时连接的功能，默认值 off
    # reset_timedout_connection on | off;
    # 配置将后端服务器的名字解析成 ip 地址的名字服务器
    # 就是指定一个 DNS 服务器地址
    # resolver address ... [valid=time] [ipv4=on|off] [ipv6=on|off] [status_zone=zone];
    # 为名字解析设置超时，默认 30s
    # resolver_timeout time;
    # Nginx 进行访问限制的有 ngx_http_access_module 模块和 ngx_http_auth_basic_module 模块
    # 默认值是 all， 表示只有当两个模块的所有限制条件(写入配置的)都授权访问时，允许请求访问
    # 设置成 any 时，表示如果当任意模块的任意限制条件授权访问时，允许请求访问
    # satisfy all | any;
    # 设置向客户端传输响应的超时，超时仅指两次相邻写操作之间的时间间隔，而非整个响应的传输时间
    # 如果客户端在这段时间中没有收到任何数据，连接将关闭
    # send_timeout time;
    # 设置用于存储子请求的响应体的缓冲区大小
    # 默认值是 4k 或 8k，默认情况下，缓冲区大小等于一个内存页，取决于平台
    # 它可以变得更小，该指令仅适用于响应体保存到内存中的子请求，例如此类子请求由 SSI 创建
    # subrequest_output_buffer_size size;
    # 开启或关闭 Nginx 使用 TCP_NODELAY 选项的功能
    # 默认 on，这个选项仅在将连接转变为长连接的时候才被启用，在 upstream 发送响应到客户端时也会启用
    tcp_nodelay on;
    # 开启或者关闭 Nginx 在 FreeBSD 上使用 TCP_NOPUSH 套接字选项， 在 Linux 上使用 TCP_CORK 套接字选项
    # 默认值是 off，选项仅在使用 sendfile 的时候才开启
    # 开启则允许：在 Linux 和 FreeBSD 4.* 上将响应头和正文的开始部分一起发送
    #              一次性发送整个文件
    tcp_nopush on;
    # 设置变量哈希桶大小，其默认值取决于处理器的缓存线长度，默认 64
    # variables_hash_bucket_size
    # 设置变量哈希表的最大size(容量)，默认值是 512
    # variables_hash_max_size size;
    # 决定 Nginx 打开文件时如何处理符号链接
    # off：默认行为，允许路径中出现符号链接，不做检查
    # on：如果文件路径中任何组成部分中含有符号链接，拒绝访问该文件
    # if_not_owner：如果文件路径中任何组成部分中含有符号链接，且符号链接和链接目标的所有者不同，拒绝访问该文件
    # from=part：当 Nginx 进行符号链接检查时(参数 on 和参数 if_not_owner )，路径中所有部分默认都会被检查
    #              而使用from=part 参数可以避免对路径开始部分进行符号链接检查，而只检查后面的部分路径
    #              如果某路径不是以指定值开始，整个路径将被检查，就如同没有指定这个参数一样
    #              如果某路径与指定值完全匹配，将不做检查
    #              这个参数的值可以包含变量
    # disable_symlinks off;

    # 应该和是和日志格式相关
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    # log设置
    access_log /var/log/nginx/access.log  main;

    # 压缩模块
    # 启用或禁用响应的 Gzip 压缩功能
    gzip on;
    # 设置用于压缩响应的缓冲区的数量和大小，默认情况下，缓冲区大小等于一内存页。这是 4K 或 8K，具体取决于平台
    gzip_buffers 16 8k;
    # 设置响应的 gzip 压缩级别，默认值是 1，可接受的值在 1 到 9 的范围内，数值越大，压缩比率越高，文件越小，但 CPU 耗费资源也越高
    gzip_comp_level 6;
    # 禁用对具有匹配任何指定正则表达式的“User-Agent”标头字段的请求的响应的 gzip 压缩
    # gzip_disable regex ...;
    # 设置压缩响应所需的请求的最低 HTTP 版本
    gzip_http_version 1.1;
    # 设置将被压缩的响应的最小长度，默认值是 20
    # gzip_min_length length;
    # 根据请求和响应启用或禁用代理请求的响应 gzip 压缩，默认值 off
    # off：禁用所有代理请求的压缩，忽略其他参数
    # expired：如果响应标头包含带有禁用缓存值的“Expires”字段，则启用压缩
    # no-cache：如果响应头包含带有“no-cache”参数的“Cache-Control”字段，则启用压缩
    # no-store：如果响应头包含带有“no-store”参数的“Cache-Control”字段，则启用压缩
    # private：如果响应头包含带有“private”参数的“Cache-Control”字段，则启用压缩
    # no_last_modified：如果响应头不包含“Last-Modified”字段，则启用压缩
    # no_etag：如果响应头不包含“ETag”字段，则启用压缩
    # auth：如果请求标头包含“授权”字段，则启用压缩
    # any：为所有代理请求启用压缩
    # 仅将响应压缩到不会在代理服务器上缓存的请求是合理的
    gzip_proxied any;
    # 对除了 “text/html” 之外，还启用对指定 MIME 类型的响应的 gzip 压缩
    # 要压缩 JSON、XML 和 JPG 类型的资源：gzip_types application/json text/xml image/jpeg;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    # 如果指令 gzip、gzip_static 或 gunzip 处于活动状态，则启用或禁用插入 “Vary: Accept-Encoding” 响应头字段
    gzip_vary on;

    # Proxy 相应头操作
    # 设置 proxy_hide_header 和 proxy_set_header 指令使用的哈希表的桶大小
    proxy_headers_hash_bucket_size 64;
    # 设置 proxy_hide_header 和 proxy_set_header 指令使用的哈希表的最大大小
    proxy_headers_hash_max_size 512;
    # 默认情况下，Nginx 不会将代理服务器的响应中的标头字段“Date”、“Server”、“X-Pad”和“X-Accel-...”传递给客户端
    # 没有默认值，proxy_hide_header 指令设置不会传递的附加字段。相反，如果需要允许传递字段，则可以使用 proxy_pass_header 指令
    # proxy_hide_header field;
    # 允许将禁用的标头字段从代理服务器传递到客户端
    # 禁用标头就是 proxy_hide_header 中说的那些默认头字段，主要是 “Date”, “Server”, “X-Pad”, 和 “X-Accel-...” 这些
    # proxy_pass_header field;
    # 禁用对来自代理服务器的某些响应头字段的处理
    # 以下字段可以忽略：“X-Accel-Redirect”、“X-Accel-Expires”、“X-Accel-Limit-Rate”（1.1.6）、“X-Accel-Buffering”（1.1.6） 、“X-Accel-Charset”（1.1.6）、“Expires”、“Cache-Control”、“Set-Cookie”（0.8.44）和“Vary”（1.7.7）
    # 如果未禁用，则处理这些标头字段具有以下效果：
    # “X-Accel-Expires”、“Expires”、“Cache-Control”、“Set-Cookie”、“Vary”设置响应缓存的参数
    # “X-Accel-Redirect”执行到指定 URI 的内部重定向
    # “X-Accel-Limit-Rate”设置向客户端传输响应的速率限制
    # “X-Accel-Buffering”启用或禁用响应缓冲
    # “X-Accel-Charset”设置响应的所需字符集
    # proxy_ignore_headers field ...;
    # 启用或禁用代理 HTTPS 服务器证书的验证
    # proxy_ssl_verify on;
    # 指定带有 PEM 格式证书的文件，用于向代理 HTTPS 服务器进行身份验证
    # proxy_ssl_certificate file;
    # 使用 PEM 格式的密钥指定一个文件，用于向代理 HTTPS 服务器进行身份验证
    # proxy_ssl_certificate_key file;
    # 指定对代理 HTTPS 服务器的请求启用的密码
    # 默认值是 DEFAULT，密码以 OpenSSL 库可以理解的格式指定，可以使用“openssl ciphers”命令查看完整列表
    # proxy_ssl_ciphers ciphers;
    # 在与代理 HTTPS 服务器建立连接时设置任意 OpenSSL 配置命令
    # proxy_ssl_conf_command name value;
    # 指定一个 PEM 格式的带有撤销证书 (CRL) 的文件，用于验证代理 HTTPS 服务器的证书
    # proxy_ssl_crl file;
    # 允许覆盖用于验证代理 HTTPS 服务器证书并在与代理 HTTPS 服务器建立连接时通过 SNI 传递的服务器名称
    # 默认情况下，使用 proxy_pass URL 的主机部分，也就是默认值是 $proxy_host
    # proxy_ssl_name name;
    # 指定一个包含密钥密码短语的文件，其中每个密码短语在单独的行中指定
    # 没有默认值，加载密钥时会依次尝试密码短语
    # proxy_ssl_password_file file;
    # 启用对代理 HTTPS 服务器的请求的指定协议
    proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
    # 在与代理 HTTPS 服务器建立连接时，启用或禁用通过 TLS 服务器名称指示扩展（SNI、RFC 6066）传递服务器名称
    proxy_ssl_server_name on;
    # 确定在使用代理服务器时是否可以重用 SSL 会话
    proxy_ssl_session_reuse on;
    # 指定具有 PEM 格式的受信任 CA 证书的文件，用于验证代理 HTTPS 服务器的证书
    # proxy_ssl_trusted_certificate file;
    # 在代理的 HTTPS 服务器证书链中设置验证深度
    # proxy_ssl_verify_depth number;

    # ssl 设置
    # 设置用于发送数据的缓冲区大小
    ssl_buffer_size 16k;
    # 加密算法
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    # 如果启用了 ssl_stapling，则指定一个带有 PEM 格式的可信 CA 证书的文件，用于验证客户端证书和 OCSP 响应
    # 证书列表将发送给客户，如果不需要，可以使用 ssl_trusted_certificate 指令
    # ssl_client_certificate file;
    # 设置任意 OpenSSL 配置命令
    # 使用 OpenSSL 1.0.2 或更高版本时支持该指令
    # 可以在同一级别上指定多个 ssl_conf_command 指令，当且仅当当前级别上没有定义 ssl_conf_command 指令时，这些指令才从先前的配置级别继承
    # 直接配置 OpenSSL 可能会导致意外行为
    # ssl_conf_command name value;
    # 指定用于验证客户端证书的 PEM 格式的已撤销证书 (CRL) 文件
    # ssl_crl file;
    # 为 DHE 密码指定具有 DH 参数的文件
    # 默认情况下未设置任何参数，因此不会使用 DHE 密码
    # ssl_dhparam file;
    # 启用或禁用 TLS 1.3 早期数据
    # 默认值是 off，在早期数据中发送的请求会受到重放攻击
    # 为了防止在应用层受到此类攻击，应使用 $ssl_early_data 变量
    # 使用 OpenSSL 1.1.1 或更高版本(1.15.4)和 BoringSSL 时支持该指令
    # ssl_early_data on | off;
    # 指定 ECDHE 密码的曲线
    # 默认值是 auto，使用 OpenSSL 1.0.2 或更高版本时，可以指定多条曲线(1.11.0)
    # 特殊值 auto(1.11.0) 指示 nginx 在使用 OpenSSL 1.0.2 或更高版本或使用旧版本的 prime256v1 时使用内置于 OpenSSL 库中的列表
    # 在 1.11.0 版本之前，默认使用 prime256v1 曲线
    # 当使用 OpenSSL 1.0.2 或更高版本时，该指令设置服务器支持的曲线列表
    # 为了使 ECDSA 证书发挥作用，重要的是包含证书中使用的曲线
    # ssl_ecdh_curve curve;
    # 启用客户端证书链的 OCSP 验证
    # 默认值是 off，leaf 参数仅启用客户端证书的验证
    # 使 OCSP 验证正常工作，应将 ssl_verify_client 指令设置为 on 或可选
    # 要解析 OCSP 响应程序主机名，还应指定解析器指令
    # ssl_ocsp on | off | leaf;
    # 为 OCSP 验证设置存储客户端证书状态的缓存的名称和大小
    # 默认值是 off ，缓存在所有工作进程之间共享。同名缓存可用于多个虚拟服务器。off 参数禁止使用缓存
    # ssl_ocsp_cache off | [shared:name:size];
    # 覆盖“授权信息访问”证书扩展中指定的 OCSP 响应者的 URL，以验证客户端证书
    # 仅支持“http://”OCSP 响应
    # ssl_ocsp_responder url;
    # 指定一个包含密钥密码短语的文件，其中每个密码短语在单独的行中指定，加载密钥时会依次尝试密码短语
    # ssl_password_file file;
    # 指定在使用 SSLv3 和 TLS 协议时，服务器加密算法应优先于客户端加密算法
    ssl_prefer_server_ciphers on;
    # 启用指定的协议
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
    # 如果启用，服务器块中的 SSL 握手将被拒绝，默认 off
    # ssl_reject_handshake on | off;
    # 设置存储会话参数的缓存的类型和大小
    # off：严格禁止使用会话缓存，nginx 明确告诉客户端会话可能不会被重用
    # none：温和地禁止使用会话缓存，nginx 告诉客户端会话可以被重用，但实际上并没有将会话参数存储在缓存中
    # builtin OpenSSL：中内置的缓存；仅由一个工作进程使用，缓存大小在会话中指定，如果未给出大小，则等于 20480 个会话，使用内置缓存会导致内存碎片
    # shared：所有工作进程之间共享的缓存，缓存大小以字节为单位指定，一兆字节可以存储大约 4000 个会话，每个共享缓存都应该有一个任意名称，同名缓存可用于多个虚拟服务器
    # 两种缓存类型可以同时使用，例如：ssl_session_cache builtin:1000 shared:SSL:10m;
    # ssl_session_cache off | none | [builtin[:size]] [shared:name:size];
    # 使用用于加密和解密 TLS 会话票证的密钥设置文件
    # 如果必须在多个服务器之间共享相同的密钥，则该指令是必需的
    # 默认情况下，使用随机生成的密钥
    # ssl_session_ticket_key file;
    # 通过 TLS 会话票证启用或禁用会话恢复
    ssl_session_tickets on;
    # 指定客户端可以重用会话参数的时间
    ssl_session_timeout 5m;
    # 启用或禁用服务器对 OCSP 响应的装订
    # 默认 off，要使 OCSP 装订工作，应该知道服务器证书颁发者的证书
    # 如果 ssl_certificate 文件不包含中间证书，则服务器证书颁发者的证书应存在于 ssl_trusted_certificate 文件中
    # 对于 OCSP 响应程序主机名的解析，还应指定解析器指令
    # ssl_stapling on | off;
    # 设置后，将从指定文件中获取装订的 OCSP 响应，而不是查询服务器证书中指定的 OCSP 响应者
    # 该文件应采用“openssl ocsp”命令生成的 DER 格式
    # ssl_stapling_file file;
    # 覆盖“授权信息访问”证书扩展中指定的 OCSP 响应者的 URL，仅支持“http://”OCSP 响应
    # ssl_stapling_responder url;
    # 启用或禁用服务器对 OCSP 响应的验证
    # 默认值 off，为了使验证工作，服务器证书颁发者的证书、根证书和所有中间证书应使用 ssl_trusted_certificate 指令配置为受信任的
    # ssl_stapling_verify on | off;
    # 如果启用了 ssl_stapling，则指定一个带有 PEM 格式的可信 CA 证书的文件，用于验证客户端证书和 OCSP 响应
    # 与 ssl_client_certificate 设置的证书相反，这些证书的列表不会发送给客户端
    # ssl_trusted_certificate file;
    # 启用客户端证书的验证，验证结果存储在 $ssl_client_verify 变量中
    # 默认值 off
    # optional：请求客户端证书并验证证书是否存在
    # optional_no_ca：请求客户端证书，但不要求它由受信任的 CA 证书签名，这适用于 nginx 外部的服务执行实际证书验证的情况，证书的内容可通过 $ssl_client_cert 变量访问
    # ssl_verify_client on | off | optional | optional_no_ca;
    # 在客户端证书链中设置验证深度
    # ssl_verify_depth number;

    # # 浏览器在发送请求时不会包含Referrer头，也就是不会告诉目标网站用户是从哪个页面链接过来的,这可以增加用户的隐私保护
    # add_header Referrer-Policy "no-referrer" always;
    # # 告诉浏览器不要尝试猜测响应的内容类型，而是严格按照服务器返回的Content-Type来解析内容，这可以防止一些安全漏洞，如MIME类型欺骗攻击
    # add_header X-Content-Type-Options "nosniff" always;
    # # 告诉浏览器始终使用HTTPS来访问网站，并且将这个设置预加载到浏览器中，以便在访问网站的子域时也强制使用HTTPS
    # # 这可以提供更强的安全性，防止中间人攻击和数据窃听
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    # 我的网页配置文件
    include /etc/nginx/conf.d/*.conf;
}

# 内嵌变量
# $arg_[name]：请求行中的 name 参数，这个 name 是可变的，指的就是 GET 参数
# $args：请求行中参数字符串
# $binary_remote_addr：客户端IP地址的二进制形式，值的长度总是4字节的 IPv4 或者16字节的 IPv6 地址
# $body_bytes_sent Nginx：返回给客户端的字节数，不含响应头
# $bytes_sent nginx：返回给客户端的字节数
# $connection：连接的序列号，这个连接是 Nginx 自己计数的，比如刚开机或者完全重启 Nginx 就会从 1 开始，然后快速访问重用 TCP 连接时也不会增加
# $connection_requests：当前通过连接发出的请求数，指的是当前这个 TCP 连接下的请求数，如果是新开的一个 TCP 连接，就会归零从1开始
# $connection_time：连接时间(以秒为单位，分辨率为毫秒)，当前建立的 TCP 连接的持续连接时间，新开 TCP 连接之后归零
# $content_length：“Content-Length” 请求头的值
# $content_type：“Content-Type” 请求头的值
# $cookie_[name]：和第一个 $arg_[name] 一样的，这里是获取指定的 Cookie 的值
# $document_root：当前请求的 root 或者 alias 指令确定的目录路径，如果是相对路径，返回的也是完整的绝对路径
# $document_uri：和 $uri 是一样的
# $host：“Host” 请求头的值，如果没有该请求头，则为与请求对应的虚拟主机的首要主机名
# $hostname：机器名称
# $http_[name]：任意请求头的值，变量名的后半部为转化为小写并且用下划线替代横线后的请求头名称，还是和 $arg_[name] 一样，只不过这回是请求头中指定的字段值
# $https：如果连接是SSL模块，返回 on ，否则返回空字符串
# $is_args：如果请求行带有参数，返回 “?”，否则返回空字符串，有 GET 参数的话，这个变量的值就是个问号，如果没有 GET 参数的话，它就是空的
# $limit_rate：允许设置此值来限制连接的传输速率
# $msec：当前时间戳，单位是秒，精度是毫秒
# $nginx_version：Nginx 的版本号
# $pid：worker进程的PID
# $pipe：如果当前请求使用 pipeline 了，就会设置为 p，否则的话就是.
# $proxy_protocol_addr：通过代理协议获取真实地址，这个和 HAProxy 这种四层代理服务器有关，简单来说就是四层负载转发过来的请求，要拿到真实 IP 比较麻烦，不像 Nginx 做反向代理时可以直接设置头，但如果使用 HAProxy 抛出的 Proxy Protocol 的话，就会简单很多
# $proxy_protocol_port：和上面的一样，不过是获取端口号
# $proxy_protocol_server_addr：通过代理协议获取服务器地址
# $proxy_protocol_server_port：通过代理协议，获取服务器端口号
# $query_string：和 $args 一样
# $realpath_root：按 root 或者 alias 配置算出的当前请求的绝对路径，如果有软连接的文件也会解析成真实的文件路径
# $remote_addr：客户端的 IP 地址，做反向代理的时候转发真实 IP 地址就靠它
# $remote_port：客户端的端口号
# $remote_user：为基本用户认证提供的用户名，这个直接请求加个 Authorization 请求头就可以测试出来
# $request：完整的原始请求行
# $request_body：请求正文，只有通过 proxy_pass 或者 fastcgi_pass 相关配置路径的路径中，这个变量里面才有值。最常见的一个需求，将 POST 请求的参数也放到 access 日志中，就需要使用这个变量。只有动态页面才可以使用，因此才必须是需要 proxy_pass 或者 FastCGI 这些的路径
# $request_body_file：请求正文的临时文件名，处理完成时，临时文件被删除，和 client_body_in_file_only 参数有关，如果在被代理的请求或者 FastCGI 中传递临时文件名，就应该禁止传递请求正文，使用 proxy_pass_request_body off 配置和 fastcgi_pass_request_body off 配置来禁止传递普通的请求正文
# $request_completion：请求完成时返回 ok，否则返回空字符串
# $request_filename：根据 root 或者 alias 配置的路径，以及请求的 URI，得到当前请求的完全文件路径
# $request_id：生成一个 16 字节的唯一哈希 ID
# $request_length：请求的长度，包括请求行、请求头以及请求体的长度
# $request_method：请求方法，就是 POST、GET 那些
# $request_time：请求处理的时间，单位为秒，精度是毫秒，请求处理时间从由客户端接收到第一个字节开始计算
# $request_uri：返回原始的请求行(带 GET 参数的)
# $scheme：请求协议的类型，比如 http 或 https
# $sent_http_[name]：响应头的信息，这个 name 可以替换成响应头的名称，比如说 $sent_http_connection 就是响应头里面的 Connection 内容
# $sent_trailer_[name]：响应结束时发送的任意字段，变量名的后半部分 name 可以替换成任意响应头的名称
# $server_addr：接受请求的服务器地址
# $server_name：接受请求的虚拟主机的首要主机名，server_name 配置指令的第一个主机名
# $server_port：接受请求的虚拟主机的端口
# $server_protocol：请求协议，通常为“HTTP/1.0”或“HTTP/1.1”
# $status：返回响应的状态码
# $tcpinfo_rtt, $tcpinfo_rttvar, $tcpinfo_snd_cwnd, $tcpinfo_rcv_space：客户端TCP连接的信息，在支持套接字选项TCP_INFO的系统中可用
# $time_iso8601：ISO 8601：标准的服务器当前时间
# $time_local：日志中的时间记录变量
# $uri：非常常用的，返回完整的 URI，不包含 GET 参数，它的值可能随请求的处理过程而改变

# SSL相关变量
# $ssl_alpn_protocol：返回 ALPN 在 SSL 握手期间选择的协议，否则返回空字符串
# $ssl_cipher：返回用于已建立 SSL 连接的加密算法的名称
# $ssl_ciphers：返回客户端支持的加密算法列表，已知密码按名称列出，未知密码以十六进制显示，只有在使用 OpenSSL 1.0.2 或更高版本时才完全支持该变量，对于旧版本，该变量仅可用于新会话并且仅列出已知密码
# $ssl_client_escaped_cert：为已建立的 SSL 连接返回 PEM 格式(urlencoded)的客户端证书
# $ssl_client_cert：为已建立的 SSL 连接返回 PEM 格式的客户端证书，除第一行之外的每一行都以制表符开头，这旨在用于 proxy_set_header 指令，该变量已弃用，应改为使用 $ssl_client_escaped_cert 变量
# $ssl_client_fingerprint：返回已建立 SSL 连接的客户端证书的 SHA1 指纹
# $ssl_client_i_dn：根据 RFC 2253 返回已建立 SSL 连接的客户端证书的“颁发者 DN”字符串
# $ssl_client_i_dn_legacy：返回已建立 SSL 连接的客户端证书的“颁发者 DN”字符串，在 1.11.6 版本之前，变量名称是 $ssl_client_i_dn
# $ssl_client_raw_cert：为已建立的 SSL 连接返回 PEM 格式的客户端证书
# $ssl_client_s_dn：根据 RFC 2253 返回已建立 SSL 连接的客户端证书的“主题 DN”字符串
# $ssl_client_s_dn_legacy：返回已建立 SSL 连接的客户端证书的“主题 DN”字符串，在 1.11.6 版本之前，变量名称是 $ssl_client_s_dn
# $ssl_client_serial：返回已建立 SSL 连接的客户端证书的序列号
# $ssl_client_v_end：返回客户端证书的结束日期
# $ssl_client_v_remain：返回客户端证书到期前的天数
# $ssl_client_v_start：返回客户端证书的开始日期
# $ssl_client_verify：如果证书不存在，则返回客户端证书验证的结果：“SUCCESS”、“FAILED:reason”和“NONE”，在 1.11.7 版本之前，“FAILED”结果不包含原因字符串
# $ssl_curve：返回用于 SSL 握手密钥交换过程的协商曲线，已知曲线按名称列出，未知曲线以十六进制显示，仅当使用 OpenSSL 3.0 或更高版本时才支持该变量，对于旧版本，变量值将是一个空字符串
# $ssl_curves：回客户端支持的曲线列表，已知曲线按名称列出，未知曲线以十六进制显示，仅当使用 OpenSSL 1.0.2 或更高版本时才支持该变量，对于旧版本，变量值将是一个空字符串，该变量仅适用于新会话
# $ssl_early_data：如果使用 TLS 1.3 早期数据并且握手未完成，则返回“1”，否则返回“”
# $ssl_protocol：返回已建立的 SSL 连接的协议
# $ssl_server_name：返回通过 SNI 请求的服务器名称
# $ssl_session_id：返回已建立 SSL 连接的会话标识符
# $ssl_session_reused：如果 SSL 会话被重用，则返回“r”，或否则返回“.”
